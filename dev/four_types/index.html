<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Forward Operator Types · ADCME</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link href="../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>ADCME</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../">Overview</a></li><li><span class="toctext">Inverse Modeling</span></li><li><span class="toctext">Automatic Differentiation</span><ul><li class="current"><a class="toctext" href>Forward Operator Types</a><ul class="internal"></ul></li></ul></li><li><span class="toctext">Resources</span><ul><li><a class="toctext" href="../customop/">Custom Operators</a></li><li><a class="toctext" href="../while_loop/">While Loops</a></li><li><a class="toctext" href="../julia_customop/">Julia Custom Operators</a></li><li><a class="toctext" href="../extra/">Miscellaneous Tools</a></li></ul></li><li><span class="toctext">Applications</span></li><li><a class="toctext" href="../api/">API Reference</a></li></ul></nav><article id="docs"><header><nav><ul><li>Automatic Differentiation</li><li><a href>Forward Operator Types</a></li></ul><a class="edit-page" href="https://github.com/kailaix/ADCME.jl/blob/master/docs/src/four_types.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Forward Operator Types</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Forward-Operator-Types-1" href="#Forward-Operator-Types-1">Forward Operator Types</a></h1><p>All numerical simulations can be decomposed into operators that are chained together. These operators range from a simple arithmetic operation such as addition or multiplication, to more sophisticated computation such as solving a linear system. Automatic differentiation relies on the differentiation of those operators and integrates them with chain rules. Therefore, it is very important for us to study the basic types of existing operators. </p><p><img src="../asset/sim.png" alt="Operators"/></p><p>In this tutorial, a operator is defined as a numerical procedure that accepts a parameter called <em>input</em>, <span>$x$</span>, and turns out a parameter called <em>ouput</em>, <span>$y=f(x)$</span>. For reverse mode automatic differentiation, besides evaluating <span>$f(x)$</span>, we need also to compute <span>$\frac{\partial J}{\partial x}$</span> given <span>$\frac{\partial J}{\partial y}$</span> where <span>$J$</span> is a functional of <span>$y$</span>. </p><p>Note  the operator <span>$y=f(x)$</span> may be implicit in the sense that <span>$f$</span> is not given directly. In general, we can write the relationship between <span>$x$</span> and <span>$y$</span> as <span>$F(x,y)=0$</span>. The operator is <em>well-defined</em> if for given <span>$x$</span>, there exists one and only one <span>$y$</span> such that <span>$F(x,y)=0$</span>. </p><p>For automatic differentiation, besides the well-definedness of <span>$F$</span>, we also require that we can compute <span>$\frac{\partial J}{\partial x}$</span> given <span>$\frac{\partial J}{\partial y}$</span>. It is easy to see that <span>$\frac{\partial J}{\partial x} = -\frac{\partial J}{\partial y}F_y^{-1}F_x$</span> Therefore, we call an operator <span>$F$</span> is <em>well-posed</em> if <span>$F_y^{-1}$</span> exists. </p><p>All operators can be classified into four types based on the linearity and explicitness.</p><ul><li><p><strong>Linear and explicit</strong> This type of operators has the form  <span>$y = Ax$</span> where <span>$A$</span> is a matrix. In this case,  <span>$F(x,y) = Ax-y$</span> and therefore  <span>$\frac{\partial J}{\partial x} = \frac{\partial J}{\partial y}A$</span></p><p>In Tensorflow, such an operator can be implemented as (assuming <code>A</code> is )</p><pre><code class="language-python">import tensorflow as tf
@tf.custom_gradient
def F(x):
    u = tf.linalg.matvec(A, x)
    def grad(dy):
        return tf.linalg.matvec(tf.transpose(A), dy)
    return u, grad</code></pre></li><li><p><strong>Nonlinear and explicit</strong> In this case, we have  <span>$y = F(x)$</span> where <span>$F$</span> is explicitly given. We have <span>$F(x,y) = F(x)-y\Rightarrow \frac{\partial J}{\partial x} = \frac{\partial J}{\partial y} F_x(x)$</span></p><p>One challenge here is we need to implement the matrix vector production <span>$\frac{\partial J}{\partial y} F_x(x)$</span> for <code>grad</code>. </p></li><li><p><strong>Linear and implicit</strong> In this case  <span>$Ay = x$</span> We have <span>$F(x,y) = x-Ay$</span> and  <span>$\frac{\partial J}{\partial x} = \frac{\partial J}{\partial y}A^{-1}$</span></p></li><li><p><strong>Nonlinear and implicit</strong> In this case <span>$F(x,y)=0$</span> and the corresponding gradient is  <span>$\frac{\partial J}{\partial x} = -\frac{\partial J}{\partial y}F_y^{-1}F_x$</span></p><p>This case is the most challenging of the four but widely seen in scientific computing code. In many numerical simulation code, <span>$F_y$</span> is usually sparse and therefore it is rewarding to exploit the sparse structure for computation acceleration in practice.</p></li></ul><footer><hr/><a class="previous" href="../"><span class="direction">Previous</span><span class="title">Overview</span></a><a class="next" href="../customop/"><span class="direction">Next</span><span class="title">Custom Operators</span></a></footer></article></body></html>
